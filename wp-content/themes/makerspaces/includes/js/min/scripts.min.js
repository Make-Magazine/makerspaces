// Compiled file - any changes will be overwritten by grunt task
var AUTH0_CLIENT_ID="fTi1CY51C4mP7cWid8IpxJsAmk7uJS7i",AUTH0_DOMAIN="makermedia.auth0.com";if("undefined"==typeof templateUrl)var templateUrl=window.location.origin;var AUTH0_CALLBACK_URL=templateUrl+"/authenticate-redirect/",AUTH0_REDIRECT_URL=templateUrl;window.addEventListener("load",function(){function loginRedirect(){if(jQuery("#authenticated-redirect").length)if(localStorage.getItem("redirect_to")){jQuery(".redirect-message").text("You will be redirected to the page you were trying to access shortly.");var redirect_url=localStorage.getItem("redirect_to");localStorage.removeItem("redirect_to"),location.href=redirect_url}else location.href=templateUrl}function setSession(authResult){var expiresAt=JSON.stringify(1e3*authResult.expiresIn+(new Date).getTime());localStorage.setItem("access_token",authResult.accessToken),localStorage.setItem("id_token",authResult.idToken),localStorage.setItem("expires_at",expiresAt)}function isAuthenticated(){if(localStorage.getItem("expires_at")){var expiresAt=JSON.parse(localStorage.getItem("expires_at"));return(new Date).getTime()<expiresAt}return!1}function displayButtons(){isAuthenticated()?(loginBtn.style.display="none",profileView.style.display="flex",getProfile(),jQuery(".logged-in").length?loginRedirect():setTimeout(function(){WPlogin()},320)):(loginBtn.style.display="flex",profileView.style.display="none",jQuery(".logged-in").length?WPlogout():loginRedirect())}function getProfile(){var accessToken=localStorage.getItem("access_token");accessToken||(console.log("Access token must exist to fetch profile"),errorMsg("Login without Access Token")),webAuth.client.userInfo(accessToken,function(err,profile){profile&&(userProfile=profile,document.querySelector("#profile-view img").src=userProfile.picture,document.querySelector("#profile-view img").style.display="block",document.querySelector("#profile-view .profile-email").innerHTML=userProfile.email)})}function WPlogin(){if("undefined"!=typeof userProfile){var access_token=(userProfile.sub,localStorage.getItem("access_token")),id_token=localStorage.getItem("id_token"),data={action:"mm_wplogin",auth0_userProfile:userProfile,auth0_access_token:access_token,auth0_id_token:id_token};jQuery.post(ajax_object.ajax_url,data,function(response){loginRedirect()}).fail(function(){alert("I'm sorry. We had an issue logging you into our system. Please try the login again."),errorMsg(userProfile.email+" had an issue logging in at the WP Login phase. That error is: "+JSON.stringify(error)),jQuery("#authenticated-redirect").length&&(jQuery(".redirect-message").text("I'm sorry. We had an issue logging you into our system. Please try the login again."),location.href=templateUrl)})}else jQuery("#authenticated-redirect").length&&(errorMsg("Login failed for undefined user: "+userProfile.email+". Timeout."),alert("We're having trouble logging you in and ran out of time. Refresh the page and we'll try harder."),jQuery(".redirect-message").html("<a href='javascript:location.reload();'>Reload page</a>"))}function WPlogout(){var data={action:"mm_wplogout"};jQuery("#wpadminbar").length&&(jQuery("body").removeClass("adminBar").removeClass("logged-in"),jQuery("#wpadminbar").remove(),jQuery("#mm-preview-settings-bar").remove()),jQuery.post(ajax_object.ajax_url,data,function(response){window.location.href="https://makermedia.auth0.com/v2/logout?returnTo="+templateUrl+"&client_id="+AUTH0_CLIENT_ID})}function errorMsg(message){var data={action:"make_error_log",make_error:message};jQuery.post(ajax_object.ajax_url,data,function(response){})}if(jQuery("#newLoginBtn").length)var loginBtn=document.getElementById("newLoginBtn");else{var loginBtn=document.createElement("div");loginBtn.setAttribute("id","newLoginBtn")}if(jQuery("#newLogoutBtn").length)var logoutBtn=document.getElementById("newLogoutBtn");else{var logoutBtn=document.createElement("div");logoutBtn.setAttribute("id","newLogoutBtn")}if(jQuery("#profile-view").length)var profileView=document.getElementById("profile-view");else{var profileView=document.createElement("div");profileView.setAttribute("id","profile-view")}loginBtn.style.display="none",profileView.style.display="none";var userProfile,webAuth=new auth0.WebAuth({domain:AUTH0_DOMAIN,clientID:AUTH0_CLIENT_ID,redirectUri:AUTH0_CALLBACK_URL,audience:"https://"+AUTH0_DOMAIN+"/userinfo",responseType:"token id_token",scope:"openid profile email",leeway:60});loginBtn.addEventListener("click",function(e){e.preventDefault(),localStorage.setItem("redirect_to",location.href),webAuth.authorize()}),logoutBtn.addEventListener("click",function(e){e.preventDefault(),localStorage.removeItem("access_token"),localStorage.removeItem("id_token"),localStorage.removeItem("expires_at"),window.location.href="https://makermedia.auth0.com/v2/logout?returnTo="+templateUrl+"&client_id="+AUTH0_CLIENT_ID}),webAuth.checkSession({},function(err,result){err?(localStorage.removeItem("access_token"),localStorage.removeItem("id_token"),localStorage.removeItem("expires_at"),"login_required"!==err.error&&(console.log(err),errorMsg(userProfile.email+" had an issue logging in at the checkSession phase. That error was: "+JSON.stringify(err)))):setSession(result),displayButtons()})}),jQuery(document).ready(function($){$(".comment-reply-link").addClass("btn btn-primary"),$("#commentsubmit").addClass("btn btn-primary"),$(".widget_search input.search-field").addClass("form-control"),$(".widget_search input.search-submit").addClass("btn btn-default"),$(".widget_rss ul").addClass("media-list"),$(".widget_meta ul, .widget_recent_entries ul, .widget_archive ul, .widget_categories ul, .widget_nav_menu ul, .widget_pages ul").addClass("nav"),$(".widget_recent_comments ul#recentcomments").css("list-style","none").css("padding-left","0"),$(".widget_recent_comments ul#recentcomments li").css("padding","5px 15px"),$("table#wp-calendar").addClass("table table-striped")}),jQuery(document).ready(function($){$(".nl-thx").fancybox({autoSize:!1,width:400,autoHeight:!0,padding:0,afterLoad:function(){this.content=this.content.html()}}),$(".nl-modal-error").fancybox({autoSize:!1,width:250,autoHeight:!0,padding:0,afterLoad:function(){this.content=this.content.html()}})});var recaptchaKey="6Lf_-kEUAAAAAHtDfGBAleSvWSynALMcgI1hc_tP";onloadCallback=function(){jQuery("#recapcha-footer-desktop").length&&grecaptcha.render("recapcha-footer-desktop",{sitekey:recaptchaKey,callback:onSubmitFooterDesk}),jQuery("#recapcha-footer-mobile").length&&grecaptcha.render("recapcha-footer-mobile",{sitekey:recaptchaKey,callback:onSubmitFooterMob}),jQuery("#recapcha-header").length&&grecaptcha.render("recapcha-header",{sitekey:recaptchaKey,callback:onSubmitHeader}),jQuery("#recapcha-playbook").length&&grecaptcha.render("recapcha-playbook",{sitekey:recaptchaKey,callback:onSubmitPlaybook})};var onSubmitHeader=function(token){jQuery.post("https://secure.whatcounts.com/bin/listctrl",jQuery(".whatcounts-signup").serialize()),jQuery(".nl-thx").trigger("click")};jQuery(document).on("submit",".whatcounts-signup",function(e){e.preventDefault(),onSubmitHeader()});var onSubmitFooterDesk=function(token){jQuery.post("https://secure.whatcounts.com/bin/listctrl",jQuery(".whatcounts-signup1f").serialize()),jQuery(".nl-thx").trigger("click")};jQuery(document).on("submit",".whatcounts-signup1f",function(e){e.preventDefault(),onSubmitFooterDesk()});var onSubmitFooterMob=function(token){jQuery.post("https://secure.whatcounts.com/bin/listctrl",jQuery(".whatcounts-signup1m").serialize()),jQuery(".nl-thx").trigger("click")};jQuery(document).on("submit",".whatcounts-signup1m",function(e){e.preventDefault(),onSubmitFooterMob()});var onSubmitPlaybook=function(token){jQuery.post("https://secure.whatcounts.com/bin/listctrl",jQuery(".playbook-sub-form").serialize()),jQuery(".nl-thx").trigger("click")};jQuery(document).on("submit",".playbook-sub-form",function(e){e.preventDefault(),onSubmitPlaybook()}),function(){var is_webkit=navigator.userAgent.toLowerCase().indexOf("webkit")>-1,is_opera=navigator.userAgent.toLowerCase().indexOf("opera")>-1,is_ie=navigator.userAgent.toLowerCase().indexOf("msie")>-1;if((is_webkit||is_opera||is_ie)&&"undefined"!=typeof document.getElementById){var eventMethod=window.addEventListener?"addEventListener":"attachEvent";window[eventMethod]("hashchange",function(){var element=document.getElementById(location.hash.substring(1));element&&(/^(?:a|select|input|button|textarea)$/i.test(element.tagName)||(element.tabIndex=-1),element.focus())},!1)}}();